# 电子秤数据分析工具

这个Python工具专为电子秤称重数据的异常检测和分析设计，能够识别称重数据中的异常值，对比不同异常检测方法的结果，并提供数据可视化功能。

## 项目结构

```
d:\project\
├── data\
│   ├── 设备0c_cf_89_47_96_7a_称重数据_2024-08-19_2025-08-19.csv
│   └── 设备称重数据_20250825_151114.xlsx
├── java\
└── python\
    ├── .idea\
    └── electronicScaleAnalysis\
        ├── README.md
        ├── csv_processor.py
        ├── main.py
        ├── 测试数据.csv
        ├── 设备0c_cf_89_47_96_7a_称重数据_2024-08-19_2025-08-19.csv
        ├── 设备3PLBJ0700_称重数据_2025-01-01_2025-08-25.csv
        └── 设备L30FH0255_称重数据_2025-08-19_2025-08-19.csv
```

## 技术栈

- Python 3.x
- 标准库: csv, os, statistics, collections
- 第三方库: matplotlib (数据可视化), numpy (数值计算), scipy (科学计算)

## 功能特点

- **CSV文件处理**: 读取、写入和过滤CSV数据
- **比值计算**: 计算称重AD值与重量的比值
- **异常检测方法**: 
  - Z-score方法（基于均值和标准差）
  - 四分位法(IQR)（基于分位数和四分位距）
- **数据可视化**: 绘制比值变化趋势折线图和分布直方图
- **异常对比分析**: 对比两种异常检测方法的结果，识别独有和共同的异常数据行
- **详细异常报告**: 输出异常数据的完整信息，包括原始数据行

## 核心功能说明

### 1. 数据分析与比值计算

```python
def analyze_file_and_get_ratios(file_path, ad_column='称重AD值', zero_ad_column='零点AD值', weight_column='重量(kg)'):
    # 分析文件并获取比值列表和完整数据
    # 返回: (比值列表, 完整数据行列表)
```

### 2. Z-score异常检测

```python
def calculate_z_scores(test_ratios, reference_ratios, test_data=None):
    # 计算测试数据比值相对于参考数据比值的Z-score
    # 返回: 包含Z-score值、异常程度和原始数据的字典列表
```

### 3. IQR异常检测

```python
def detect_outliers_with_iqr(device_ratios, test_ratios, test_data=None):
    # 使用四分位法检测测试数据中的异常值
    # 返回: 包含比值、是否异常和原始数据的字典列表
```

### 4. 异常数据检查

```python
def check_outliers(test_ratios, lower_bound, upper_bound):
    # 检查测试数据比值是否超出异常值范围
    # 返回: 包含比值和是否异常的字典列表
```

## 使用方法

### 单台秤数据分析示例

```python
def single_scale_example_usage():
    # 单台秤的称重失准异常分析示例
    # 1. 读取测试数据和设备数据
    # 2. 计算比值
    # 3. 使用Z-score方法检测异常
    # 4. 使用IQR方法检测异常
    # 5. 对比两种方法的检测结果
```

直接运行脚本即可执行示例分析：

```bash
python csv_processor.py
```

## 输出内容说明

运行示例后，将输出以下内容：

1. **数据读取信息**: 显示读取的文件路径和记录数
2. **Z-score计算结果**: 显示每个数据点的Z-score值和异常程度
3. **Z-score异常数据行**: 显示Z-score方法检测到的异常数据的完整原始数据
4. **设备数据的异常值检测范围**: 显示IQR方法的Q1、Q3、IQR和正常范围
5. **IQR异常值检测结果**: 显示每个数据点的比值和异常状态
6. **IQR异常数据行**: 显示IQR方法检测到的异常数据的完整原始数据
7. **两种方法检测异常数据行坐标对比**: 显示仅Z-score检测到、仅IQR检测到以及两种方法共检测到的异常数据行坐标
8. **数据可视化图表**: 显示比值变化趋势折线图和分布直方图

## 注意事项

1. 确保CSV文件包含必要的列："称重AD值"、"零点AD值"和"重量(kg)"
2. 确保中文正常显示，matplotlib已配置支持中文字体
3. 对于大型CSV文件，可能需要优化内存使用
4. 当参考数据不足时，部分异常检测功能可能无法使用

## 扩展建议

1. 支持多台秤数据的对比分析
2. 实现自动生成PDF格式的分析报告
3. 添加更多异常检测算法（如LOF、Isolation Forest等）
4. 开发简单的Web界面以提高用户体验
5. 实现数据导出功能，便于后续分析和报告生成